# ============================================
# Session Crypto PoC - Environment Variables
# ============================================
# Copy this file to .env and update with your actual values

# ============================================
# Server Configuration
# ============================================

# Port for the server to listen on
# Default: 3000
PORT=3000

# Log level (trace, debug, info, warn, error, fatal)
# Default: info
LOG_LEVEL=info

# Node environment (development, production, test, staging)
# Default: development
NODE_ENV=development

# ============================================
# Redis Configuration (required)
# ============================================

# Redis host address
# Example: localhost, redis.example.com, 10.0.0.5
REDIS_HOST=localhost

# Redis port number
# Default: 6379
REDIS_PORT=6379

# Redis password (if authentication is enabled)
# Leave empty if no password is required
# REDIS_PASSWORD=your_redis_password

# Redis command timeout in milliseconds
# How long to wait for Redis commands to complete
# Default: 5000 (5 seconds)
REDIS_COMMAND_TIMEOUT_MS=5000

# Redis connection timeout in milliseconds
# How long to wait for Redis to become ready at startup
# Default: 10000 (10 seconds)
REDIS_CONNECTION_TIMEOUT_MS=10000

# ============================================
# PostgreSQL Configuration (required)
# ============================================

# PostgreSQL host address
# Example: localhost, postgres.example.com, 10.0.0.10
POSTGRES_HOST=localhost

# PostgreSQL port number
# Default: 5432
POSTGRES_PORT=5432

# PostgreSQL database name
POSTGRES_DB=session_crypto

# PostgreSQL username
POSTGRES_USER=postgres

# PostgreSQL password
POSTGRES_PASSWORD=postgres

# Enable SSL for PostgreSQL connection
# Set to 'true' for production environments
# Default: false
POSTGRES_SSL=false

# PostgreSQL connection pool maximum connections
# Default: 25
PG_POOL_MAX=25

# PostgreSQL idle connection timeout in milliseconds
# Close idle connections after this time
# Default: 60000 (1 minute)
PG_IDLE_TIMEOUT_MS=60000

# PostgreSQL connection timeout in milliseconds
# Fail fast if can't connect within this time
# Default: 5000 (5 seconds)
PG_CONNECTION_TIMEOUT_MS=5000

# ============================================
# PostgreSQL Query Timeout Configuration
# ============================================
# NOTE: Query/statement timeout is NOT configured via application code
# when using PgBouncer transaction pooling (Azure PostgreSQL).
#
# You MUST configure statement_timeout at the PostgreSQL database level:
#
# Option 1 - Database-specific (Recommended):
#   ALTER DATABASE session_crypto SET statement_timeout = '5s';
#
# Option 2 - Azure Portal:
#   Navigate to: Azure Portal > PostgreSQL Server > Server parameters
#   Set: statement_timeout = 5000 (milliseconds)
#
# Option 3 - Server-wide via SQL:
#   ALTER SYSTEM SET statement_timeout = '5s';
#   SELECT pg_reload_conf();
#
# For benchmarking with high load, use: 30000ms (30 seconds)

# ============================================
# Session Configuration
# ============================================

# Minimum session TTL in seconds
# Default: 300 (5 minutes)
SESSION_TTL_MIN_SEC=300

# Maximum session TTL in seconds
# Default: 3600 (1 hour)
SESSION_TTL_MAX_SEC=3600

# Default session TTL in seconds
# Used when client doesn't specify a TTL
# Default: 1800 (30 minutes)
SESSION_TTL_DEFAULT_SEC=1800

# ============================================
# Replay Protection Configuration
# ============================================

# Timestamp window in milliseconds
# Reject requests with timestamps outside this window
# Default: 300000 (5 minutes)
TIMESTAMP_WINDOW_MS=300000

# Nonce TTL in seconds
# How long to store nonces to prevent replay attacks
# Default: 300 (5 minutes)
NONCE_TTL_SEC=300

# ============================================
# Memory Nonce Store Configuration (Fallback)
# ============================================
# When Redis is unavailable, nonces are stored in-memory.
# With sticky sessions, each pod handles a subset of clients.

# Maximum entries in memory nonce store
# Default: 100000 (100K entries, ~10MB memory)
MEMORY_NONCE_MAX_SIZE=100000

# Threshold to trigger cleanup (should be < max size)
# When reached, expired nonces are cleaned up proactively
# Default: 80000 (80% of max)
MEMORY_NONCE_CLEANUP_THRESHOLD=80000

# ============================================
# Client Configuration (Node.js client only)
# ============================================

# Server URL for the Node.js client to connect to
# Default: http://localhost:3000
SERVER_URL=http://localhost:3000

# Client HTTP request timeout in milliseconds
# Default: 5000 (5 seconds)
CLIENT_REQUEST_TIMEOUT_MS=5000

# ============================================
# Optional Configuration
# ============================================

# Enable CORS for specific origins (comma-separated)
# Leave empty or set to 'true' to allow all origins (development only)
# CORS_ORIGIN=https://app.example.com,https://www.example.com

# ============================================
# Production Deployment Notes
# ============================================
#
# Security:
# 1. Never commit the actual .env file to version control
# 2. Always use strong passwords in production
# 3. Enable POSTGRES_SSL=true in production
# 4. Use a secret management service (AWS Secrets Manager, Azure Key Vault, etc.)
# 5. Restrict CORS_ORIGIN to specific domains
#
# Performance:
# 6. Set LOG_LEVEL=warn or LOG_LEVEL=error in production
# 7. Adjust PG_POOL_MAX based on your database capacity
# 8. Tune timeouts based on your network latency and load
# 9. Consider increasing SESSION_TTL_MAX_SEC for better UX
#
# Monitoring:
# 10. Monitor timeout errors in logs
# 11. Track Redis and PostgreSQL connection pool usage
# 12. Set up alerts for replay attack attempts (REPLAY_DETECTED errors)
#
# ============================================
